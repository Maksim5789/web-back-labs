{% extends 'base.html' %}

{% block title %}Редактировать книгу{% endblock %}

{% block content %}
<div class="edit-book-container">
    <h1>Редактировать книгу</h1>
    
    <div>
        <label for="book_id">ID Книги:</label>
        <input type="text" id="book_id" placeholder="Введите ID книги">
    </div>
    
    <div>
        <label for="title">Название:</label>
        <input type="text" id="title" placeholder="Введите название книги">
    </div>

    <div>
        <label for="author">Автор:</label>
        <input type="text" id="author" placeholder="Введите автора книги">
    </div>

    <div>
        <label for="year_of_publication">Год издания:</label>
        <input type="number" id="year_of_publication" placeholder="Введите год издания книги">
    </div>

    <div>
        <label for="publisher">Издатель:</label>
        <input type="text" id="publisher" placeholder="Введите издателя">
    </div>

    <div>
        <label for="book_cover">Обложка:</label>
        <input type="text" id="book_cover" placeholder="Введите ссылку на обложку">
    </div>

    <div>
        <label for="amount_of_pages">Количество страниц:</label>
        <input type="number" id="amount_of_pages" placeholder="Введите количество страниц">
    </div>

    <button id="update-button">Обновить книгу</button>

    <div id="result-message"></div>
</div>

<script>
    document.getElementById('update-button').addEventListener('click', async () => {
        const bookId = document.getElementById('book_id').value;
        const title = document.getElementById('title').value;
        const author = document.getElementById('author').value;
        const yearOfPublication = document.getElementById('year_of_publication').value;
        const publisher = document.getElementById('publisher').value;
        const bookCover = document.getElementById('book_cover').value;
        const amountOfPages = document.getElementById('amount_of_pages').value;

        const payload = {
            jsonrpc: '2.0',
            method: 'edit_book',
            params: {
                id: bookId,
                title: title,
                author: author,
                year_of_publication: yearOfPublication,
                publisher: publisher,
                book_cover: bookCover,
                amount_of_pages: amountOfPages
            }
        };

        try {
            const response = await fetch('/rgz/edit_book', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            });

            const result = await response.json();
            if (response.ok) {
                document.getElementById('result-message').innerHTML = `
                    <p>${result.result.message}</p>
                    <p><a href="${result.result.redirect}">Перейти к управлению книгами</a></p>`;
            } else {
                document.getElementById('result-message').innerText = result.error.message;
            }
        } catch (error) {
            document.getElementById('result-message').innerText = 'Произошла ошибка при обновлении книги.';
            console.error('Ошибка:', error);
        }
    });
</script>
{% endblock %}
